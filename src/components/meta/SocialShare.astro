---
import Mastodon from "@/assets/share/mastodon.svg";
import QQ from "@/assets/share/qq.svg";
import Twitter from "@/assets/share/twitter.svg";
import themeConfig from "@/config";
import type { SocialSharePlatform } from "@/types";

interface Props {
  title: string;
  url: string;
  summary?: string;
}

const { title, url, summary = "" } = Astro.props;
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
const encodedSummary = encodeURIComponent(summary);
const mastodonText = encodeURIComponent(`${title} ${url}`);

const shareItemMap: Record<
  SocialSharePlatform,
  { name: string; href: string; Icon: typeof Twitter }
> = {
  twitter: {
    name: "Twitter",
    href: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
    Icon: Twitter,
  },
  qq: {
    name: "QQ",
    href: `https://connect.qq.com/widget/shareqq/index.html?url=${encodedUrl}&title=${encodedTitle}&summary=${encodedSummary}`,
    Icon: QQ,
  },
  mastodon: {
    name: "Mastodon",
    href: `https://mastodon.social/share?text=${mastodonText}`,
    Icon: Mastodon,
  },
};

const shareItems = themeConfig.socialShare.providers
  .map((provider) => shareItemMap[provider])
  .filter(Boolean);
---

<h2>分享</h2>
<div class="social-share-list">
  {
    shareItems.map(({ name, href, Icon }) => (
      <a
        href={href}
        target="_blank"
        rel="noopener noreferrer nofollow"
        class="social-share-btn"
        aria-label={`Share to ${name}`}
        title={`Share to ${name}`}
      >
        <Icon class="social-share-icon" />
      </a>
    ))
  }
</div>

<style>
  .social-share-list {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    margin-bottom: 2rem;
  }

  .social-share-btn {
    width: 2.25rem;
    height: 2.25rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 9999px;
    border: 1px solid #d4d4d8;
    color: #3f3f46;
    background-color: #fafafa;
    transition: all var(--transition-fast);
    text-decoration: none;
  }

  .social-share-icon {
    width: 1.1rem;
    height: 1.1rem;
  }

  .social-share-btn:hover {
    background-color: #f1f5f9;
    color: #18181b;
    border-color: #a1a1aa;
    transform: translateY(-1px);
  }

  .social-share-btn:focus-visible {
    outline: 2px solid var(--color-anchor);
    outline-offset: 2px;
  }

  html.dark .social-share-btn {
    border-color: #3f3f46;
    color: #d4d4d8;
    background-color: #232326;
  }

  html.dark .social-share-btn:hover {
    background-color: #2f2f35;
    color: #f5f5f5;
    border-color: #71717a;
  }
</style>
